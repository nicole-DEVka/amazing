<!DOCTYPE html>
<html lang="cs">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AmazingMaky</title>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,700;1,400&family=DM+Sans:wght@300;400;500;600&display=swap" rel="stylesheet">
<style>
  :root {
    --primary: #F564A9;
    --primary-dark: #E84B91;
    --primary-light: #FFC1E3;
    --secondary: #CDB4FF;
    --accent: #FF8DC7;
    --light-bg: #FFF0F7;
    --very-light-bg: #FFD6EC;
    --dark-text: #7A3E6D;
    --white: #FFFFFF;
    --shadow: 0 8px 24px rgba(245, 100, 169, 0.15);
    --shadow-sm: 0 4px 12px rgba(245, 100, 169, 0.1);
    --blush: #FFC1E3;
    --blush-light: #FFD6EC;
    --pale: #FFF0F7;
    --lavender: #CDB4FF;
    --text: #7A3E6D;
    --text-soft: #b07a9e;
    --shadow-lg: 0 8px 40px rgba(245, 100, 169, 0.22);
    --radius: 20px;
    --radius-sm: 12px;
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    font-family: 'DM Sans', sans-serif;
    background: linear-gradient(135deg, var(--light-bg) 0%, var(--very-light-bg) 100%);
    color: var(--dark-text);
    min-height: 100vh;
    overflow-x: hidden;
  }

  /* Login Button Styling */
  .login-overlay {
    position: fixed; inset: 0; background: var(--light-bg);
    display: flex; flex-direction: column; align-items: center; justify-content: center;
    z-index: 2000;
  }
  .btn-login {
    background: linear-gradient(135deg, var(--primary), var(--accent));
    color: white; border: none; border-radius: 14px;
    padding: 16px 32px; font-size: 18px; font-weight: 600;
    cursor: pointer; box-shadow: var(--shadow-lg);
    display: flex; align-items: center; gap: 10px;
  }

  /* HEADER */
  .header {
    background: linear-gradient(135deg, var(--primary) 0%, var(--accent) 100%);
    padding: 24px 20px 32px; position: relative;
  }
  .header-inner { max-width: 480px; margin: 0 auto; position: relative; z-index: 1; }
  .app-title { font-family: 'Playfair Display', serif; font-size: 32px; color: white; }
  .app-title span { font-style: italic; opacity: 0.85; }
  .app-subtitle { color: rgba(255,255,255,0.8); font-size: 13px; margin-top: 2px; }

  /* STATS */
  .stats-card { max-width: 480px; margin: -18px auto 0; padding: 0 16px; position: relative; z-index: 10; }
  .stats-inner {
    background: white; border-radius: var(--radius); padding: 16px 20px;
    box-shadow: var(--shadow-lg); display: flex; align-items: center; gap: 12px;
  }
  .stats-icon {
    width: 48px; height: 48px; background: linear-gradient(135deg, var(--accent), var(--primary));
    border-radius: 14px; display: flex; align-items: center; justify-content: center;
    font-size: 20px; color: white; flex-shrink: 0;
  }
  .stats-value { font-family: 'Playfair Display', serif; font-size: 28px; color: var(--primary); line-height: 1; }

  /* CALENDAR */
  .calendar-wrap { max-width: 480px; margin: 20px auto 0; padding: 0 16px; }
  .calendar-card { background: white; border-radius: var(--radius); box-shadow: var(--shadow); overflow: hidden; }
  .cal-nav { display: flex; align-items: center; justify-content: space-between; padding: 18px 20px 14px; border-bottom: 1px solid var(--blush-light); }
  .cal-month { font-family: 'Playfair Display', serif; font-size: 20px; color: var(--text); }
  .cal-nav-btn { width: 36px; height: 36px; border: none; background: var(--pale); color: var(--primary); border-radius: 10px; cursor: pointer; }
  .cal-weekdays { display: grid; grid-template-columns: repeat(7, 1fr); padding: 8px 12px 4px; }
  .cal-weekday { text-align: center; font-size: 11px; font-weight: 600; color: var(--text-soft); text-transform: uppercase; }
  .cal-days { display: grid; grid-template-columns: repeat(7, 1fr); padding: 4px 12px 16px; gap: 2px; }
  .cal-day {
    aspect-ratio: 1; display: flex; align-items: center; justify-content: center;
    border-radius: 50%; cursor: pointer; font-size: 15px; position: relative; transition: 0.2s; color: var(--text);
  }
  .cal-day.today { background: linear-gradient(135deg, var(--primary), var(--accent)); color: white; box-shadow: 0 3px 12px rgba(245,100,169,0.4); }
  .cal-day.completed { background: linear-gradient(135deg, var(--secondary) 0%, #B896E8 100%); color: white; }
  .cal-day.completed::after { content: '‚úì'; position: absolute; bottom: -3px; right: -3px; width: 18px; height: 18px; background: var(--accent); border-radius: 50%; font-size: 11px; color: white; line-height: 18px; text-align: center; }
  .cal-day.has-workout:not(.completed)::after { content: '‚Ä¢'; position: absolute; bottom: 2px; left: 50%; transform: translateX(-50%); font-size: 14px; color: var(--primary); }

  /* SCREENS */
  .screen { display: none; }
  .screen.active { display: block; }

  /* DAY DETAIL */
  .day-header { background: linear-gradient(135deg, var(--primary) 0%, var(--accent) 100%); padding: 20px 16px 28px; }
  .back-btn { background: rgba(255,255,255,0.2); border: none; color: white; border-radius: 10px; padding: 8px 14px; cursor: pointer; }
  .day-date { font-family: 'Playfair Display', serif; font-size: 26px; color: white; margin-top: 12px; }
  .btn-complete { background: white; color: var(--primary-dark); border: none; border-radius: 12px; padding: 10px 18px; font-weight: 600; cursor: pointer; margin-top: 16px; }
  .btn-complete.done { background: rgba(255,255,255,0.25); color: white; border: 2px solid rgba(255,255,255,0.5); }

  .exercises-wrap { max-width: 480px; margin: -14px auto 0; padding: 0 16px 100px; }
  .exercise-card { background: white; border-radius: var(--radius); padding: 16px; margin-bottom: 12px; box-shadow: var(--shadow); position: relative; }
  .exercise-name { font-weight: 600; display: flex; justify-content: space-between; margin-bottom: 10px; }
  .exercise-delete { background: none; border: none; color: #ddd; cursor: pointer; }
  .exercise-pills { display: flex; flex-wrap: wrap; gap: 6px; }
  .pill { background: var(--blush-light); color: var(--primary-dark); border-radius: 20px; padding: 4px 12px; font-size: 12px; }
  .feedback-input { width: 100%; border: 1.5px solid var(--blush); border-radius: 10px; padding: 8px; margin-top: 10px; outline: none; }

  /* FAB & MODAL */
  .fab { position: fixed; bottom: 24px; right: 24px; width: 60px; height: 60px; background: linear-gradient(135deg, var(--primary), var(--accent)); border: none; border-radius: 50%; color: white; font-size: 28px; cursor: pointer; z-index: 100; }
  .fab.hidden { display: none; }
  .modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.3); backdrop-filter: blur(4px); z-index: 200; display: none; align-items: flex-end; justify-content: center; }
  .modal-overlay.open { display: flex; }
  .modal { background: white; border-radius: 28px 28px 0 0; padding: 24px; width: 100%; max-width: 480px; }
  .form-input { width: 100%; border: 1.5px solid var(--blush-light); border-radius: 12px; padding: 12px; margin-bottom: 10px; outline: none; }
  .btn-save { width: 100%; background: var(--primary); color: white; border: none; border-radius: 14px; padding: 16px; font-weight: 600; cursor: pointer; }

  .toast { position: fixed; top: 20px; left: 50%; transform: translateX(-50%) translateY(-80px); background: var(--dark-text); color: white; padding: 12px 20px; border-radius: 12px; z-index: 3000; transition: 0.3s; }
  .toast.show { transform: translateX(-50%) translateY(0); }
</style>
</head>
<body>

<div id="login-screen" class="login-overlay">
  <h1 style="font-family:'Playfair Display'; color:var(--text); margin-bottom:20px;">AmazingMaky</h1>
  <button class="btn-login" id="btn-login-google">
    <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" width="20">
    P≈ôihl√°sit se p≈ôes Google
  </button>
</div>

<div class="toast" id="toast"></div>

<div class="screen active" id="screen-calendar">
  <div class="header">
    <div class="header-inner">
      <div class="app-title">Amazing<span>Maky</span></div>
      <div class="app-subtitle">Fitness planner</div>
    </div>
  </div>

  <div class="stats-card">
    <div class="stats-inner">
      <div class="stats-icon">‚òÖ</div>
      <div>
        <div style="font-size:12px; color:var(--text-soft)">Odcviƒçen√© tr√©ninky</div>
        <div class="stats-value" id="completed-count">0</div>
      </div>
    </div>
  </div>

  <div class="calendar-wrap">
    <div class="calendar-card">
      <div class="cal-nav">
        <button class="cal-nav-btn" id="prev-month">‚Üê</button>
        <div class="cal-month" id="cal-month-label"></div>
        <button class="cal-nav-btn" id="next-month">‚Üí</button>
      </div>
      <div class="cal-weekdays">
        <div class="cal-weekday">Po</div><div class="cal-weekday">√öt</div><div class="cal-weekday">St</div><div class="cal-weekday">ƒåt</div><div class="cal-weekday">P√°</div><div class="cal-weekday">So</div><div class="cal-weekday">Ne</div>
      </div>
      <div class="cal-days" id="cal-days"></div>
    </div>
  </div>
</div>

<div class="screen" id="screen-day">
  <div class="day-header">
    <button class="back-btn" id="back-btn">‚Üê Kalend√°≈ô</button>
    <div class="day-date" id="day-date-title"></div>
    <div class="day-date-sub" id="day-date-sub"></div>
    <button class="btn-complete" id="btn-complete">üéØ Oznaƒçit jako splnƒõn√Ω</button>
  </div>
  <div class="exercises-wrap" id="exercises-wrap"></div>
</div>

<div class="modal-overlay" id="modal-overlay">
  <div class="modal">
    <div class="app-subtitle" style="color:var(--text); margin-bottom:10px;">P≈òIDAT CVIK</div>
    <input class="form-input" type="text" id="f-name" placeholder="N√°zev cviku *">
    <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px;">
      <input class="form-input" type="number" id="f-sets" placeholder="S√©rie">
      <input class="form-input" type="number" id="f-reps" placeholder="Opakov√°n√≠">
    </div>
    <input class="form-input" type="number" id="f-weight" placeholder="V√°ha (kg)">
    <input class="form-input" type="text" id="f-note" placeholder="Pozn√°mka">
    <button class="btn-save" id="btn-save-exercise">Ulo≈æit do cloudu</button>
  </div>
</div>

<button class="fab hidden" id="fab">+</button>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
  import { getFirestore, doc, setDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";
  import { getAuth, signInWithPopup, GoogleAuthProvider, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";

  const firebaseConfig = {
    apiKey: "AIzaSyDA5fywHFPg81FfjIiQNwnotQl_racWrRE",
    authDomain: "amazingmaky-44a77.firebaseapp.com",
    projectId: "amazingmaky-44a77",
    storageBucket: "amazingmaky-44a77.firebasestorage.app",
    messagingSenderId: "848808773416",
    appId: "1:848808773416:web:da3ac37e905e9e52b5321d"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);
  const auth = getAuth(app);
  const provider = new GoogleAuthProvider();

  // Reference odpov√≠daj√≠c√≠ tv√Ωm Rules: kolekce 'state', dokument 'spolecny_kalendar'
  const docRef = doc(db, "state", "spolecny_kalendar");

  let localDataState = {};
  let currentView = 'calendar';
  let viewYear = new Date().getFullYear();
  let viewMonth = new Date().getMonth();
  let selectedDateKey = null;
  let unsubscribe = null;

  // --- AUTH ---
  document.getElementById('btn-login-google').onclick = () => signInWithPopup(auth, provider);

  onAuthStateChanged(auth, (user) => {
    if (user) {
      document.getElementById('login-screen').style.display = 'none';
      startSync();
    } else {
      document.getElementById('login-screen').style.display = 'flex';
    }
  });

  function startSync() {
    if (unsubscribe) unsubscribe();
    unsubscribe = onSnapshot(docRef, (snap) => {
      localDataState = snap.exists() ? snap.data() : {};
      renderCalendar();
      if (currentView === 'day') renderDayDetail();
    }, (err) => {
      console.error(err);
      showToast("Chyba p≈ô√≠stupu. Zkontroluj Rules!");
    });
  }

  // --- DATA LOGIC ---
  async function saveData(data) {
    try {
      await setDoc(docRef, data);
    } catch (e) {
      showToast("Nepoda≈ôilo se ulo≈æit.");
    }
  }

  function renderCalendar() {
    const data = localDataState;
    const today = todayKey();
    document.getElementById('cal-month-label').textContent = `${monthNames[viewMonth]} ${viewYear}`;
    document.getElementById('completed-count').textContent = Object.values(data).filter(d => d.completed).length;

    const daysEl = document.getElementById('cal-days');
    daysEl.innerHTML = '';

    const first = new Date(viewYear, viewMonth, 1);
    let startDow = (first.getDay() + 6) % 7;
    const daysInMonth = new Date(viewYear, viewMonth+1, 0).getDate();

    for (let i = 0; i < startDow; i++) daysEl.appendChild(Object.assign(document.createElement('div'), {className:'cal-day empty'}));
    
    for (let d = 1; d <= daysInMonth; d++) {
      const key = dateKey(viewYear, viewMonth, d);
      const dayData = data[key];
      const el = document.createElement('div');
      el.className = 'cal-day';
      el.textContent = d;
      if (key === today) el.classList.add('today');
      if (dayData?.completed) el.classList.add('completed');
      if (dayData?.exercises?.length) el.classList.add('has-workout');
      el.onclick = () => openDay(key);
      daysEl.appendChild(el);
    }
  }

  function renderDayDetail() {
    const day = localDataState[selectedDateKey] || { exercises: [] };
    const btn = document.getElementById('btn-complete');
    btn.textContent = day.completed ? 'Splnƒõno ‚úì' : 'üéØ Oznaƒçit jako splnƒõn√Ω';
    btn.className = day.completed ? 'btn-complete done' : 'btn-complete';
    btn.onclick = toggleComplete;

    const wrap = document.getElementById('exercises-wrap');
    wrap.innerHTML = day.exercises.length ? day.exercises.map((ex, i) => `
      <div class="exercise-card">
        <div class="exercise-name">${esc(ex.name)} <button onclick="deleteExercise(${i})">‚úï</button></div>
        <div class="exercise-pills">
          <div class="pill">üí™ ${ex.sets}x${ex.reps}</div>
          ${ex.weight ? `<div class="pill">‚öñÔ∏è ${ex.weight}kg</div>` : ''}
        </div>
        <textarea class="feedback-input" placeholder="Tvoje pocity..." onchange="saveFeedback(${i}, this.value)">${esc(ex.feedback||'')}</textarea>
      </div>
    `).join('') : '<div class="empty-state">≈Ω√°dn√© cviky</div>';
  }

  // --- ACTIONS ---
  window.deleteExercise = (idx) => {
    const data = {...localDataState};
    data[selectedDateKey].exercises.splice(idx, 1);
    saveData(data);
  };

  window.saveFeedback = (idx, val) => {
    const data = {...localDataState};
    data[selectedDateKey].exercises[idx].feedback = val;
    saveData(data);
  };

  function toggleComplete() {
    const data = {...localDataState};
    if (!data[selectedDateKey]) data[selectedDateKey] = { exercises: [] };
    data[selectedDateKey].completed = !data[selectedDateKey].completed;
    saveData(data);
  }

  document.getElementById('btn-save-exercise').onclick = () => {
    const name = document.getElementById('f-name').value;
    if (!name) return showToast("Zadej n√°zev");
    const data = {...localDataState};
    if (!data[selectedDateKey]) data[selectedDateKey] = { exercises: [], completed: false };
    data[selectedDateKey].exercises.push({
      name, 
      sets: document.getElementById('f-sets').value || 0,
      reps: document.getElementById('f-reps').value || 0,
      weight: document.getElementById('f-weight').value || 0,
      note: document.getElementById('f-note').value,
      feedback: ''
    });
    saveData(data);
    document.getElementById('modal-overlay').classList.remove('open');
  };

  // --- UI & UTILS ---
  const monthNames = ['Leden','√önor','B≈ôezen','Duben','Kvƒõten','ƒåerven','ƒåervenec','Srpen','Z√°≈ô√≠','≈ò√≠jen','Listopad','Prosinec'];
  function todayKey() { const t = new Date(); return dateKey(t.getFullYear(), t.getMonth(), t.getDate()); }
  function dateKey(y, m, d) { return `${y}-${String(m+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`; }
  function esc(s) { return String(s||'').replace(/&/g,'&amp;').replace(/</g,'&lt;'); }
  
  function openDay(key) {
    selectedDateKey = key;
    document.getElementById('day-date-title').textContent = key;
    renderDayDetail();
    showScreen('day');
  }

  function showScreen(s) {
    document.getElementById('screen-calendar').classList.toggle('active', s==='calendar');
    document.getElementById('screen-day').classList.toggle('active', s==='day');
    document.getElementById('fab').classList.toggle('hidden', s!=='day');
    currentView = s;
  }

  document.getElementById('back-btn').onclick = () => showScreen('calendar');
  document.getElementById('fab').onclick = () => document.getElementById('modal-overlay').classList.add('open');
  document.getElementById('modal-overlay').onclick = (e) => { if(e.target.id==='modal-overlay') e.target.classList.remove('open'); };
  document.getElementById('prev-month').onclick = () => { viewMonth--; if(viewMonth<0){viewMonth=11;viewYear--;} renderCalendar(); };
  document.getElementById('next-month').onclick = () => { viewMonth++; if(viewMonth>11){viewMonth=0;viewYear++;} renderCalendar(); };

  function showToast(m) {
    const t = document.getElementById('toast'); t.textContent = m; t.classList.add('show');
    setTimeout(() => t.classList.remove('show'), 3000);
  }
</script>
</body>
</html>
